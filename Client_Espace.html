<!DOCTYPE html>
<html lang="fr">
<head>
  <? var appUrl = ScriptApp.getService().getUrl(); var nomService = NOM_ENTREPRISE; ?>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Livraison pharmacie à domicile et EHPAD sur Tamaris, Mar Vivo, Six-Fours-les-Plages, Sanary, Portissol et Bandol.">
  <link rel="canonical" href="<?= appUrl ?>">
  <meta property="og:title" content="<?= nomService ?> | Mon Espace Client">
  <meta property="og:description" content="Livraison pharmacie à domicile et EHPAD sur Tamaris, Mar Vivo, Six-Fours-les-Plages, Sanary, Portissol et Bandol.">
  <meta property="og:url" content="<?= appUrl ?>">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="<?= nomService ?> | Mon Espace Client">
  <meta name="twitter:description" content="Livraison pharmacie à domicile et EHPAD sur Tamaris, Mar Vivo, Six-Fours-les-Plages, Sanary, Portissol et Bandol.">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "LocalBusiness",
        "@id": "<?= appUrl ?>#business",
        "name": "<?= nomService ?>",
        "description": "Livraison pharmacie à domicile et EHPAD sur Tamaris, Mar Vivo, Six-Fours-les-Plages, Sanary, Portissol et Bandol.",
        "url": "<?= appUrl ?>",
        "email": "<?= EMAIL_ENTREPRISE ?>",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Six-Fours-les-Plages",
          "addressCountry": "FR"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 43.0842,
          "longitude": 5.8009
        },
        "areaServed": [
          { "@type": "Place", "name": "Tamaris" },
          { "@type": "Place", "name": "Mar Vivo" },
          { "@type": "Place", "name": "Six-Fours-les-Plages" },
          { "@type": "Place", "name": "Sanary" },
          { "@type": "Place", "name": "Portissol" },
          { "@type": "Place", "name": "Bandol" }
        ]
      },
      {
        "@type": "Service",
        "@id": "<?= appUrl ?>#service",
        "serviceType": "Livraison de pharmacie",
        "provider": { "@id": "<?= appUrl ?>#business" },
        "areaServed": [
          { "@type": "Place", "name": "Tamaris" },
          { "@type": "Place", "name": "Mar Vivo" },
          { "@type": "Place", "name": "Six-Fours-les-Plages" },
          { "@type": "Place", "name": "Sanary" },
          { "@type": "Place", "name": "Portissol" },
          { "@type": "Place", "name": "Bandol" }
        ]
      }
    ]
  }
  </script>
  <title><?= nomService ?> | Mon Espace Client</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <?!= include('ThemeCapsule') ?>
  <style id="theme-style"></style>
  <?!= include('Client_CSS'); ?>
  <?!= include('charte'); ?>
  <? if (typeof CLIENT_CHARTS_ENABLED !== 'undefined' && CLIENT_CHARTS_ENABLED) { ?>
    <?!= include('GoogleChartsStub'); ?>
  <? } ?>
</head>
<body data-brand-name="<?= nomService ?>" data-brand-home="<?= appUrl ?>" data-brand-logo="<?= BRANDING_LOGO_PUBLIC_URL ?>">

  <div id="indicateur-chargement" class="indicateur-chargement-overlay">
    <div class="spinner"></div>
  </div>

  <div id="app-conteneur-principal">
    <header class="app-en-tete">
      <div class="app-logo-container" data-logo-slot>
        <span class="app-logo--fallback" data-logo-fallback="<?= nomService ?>"<?= nomService ?></span>
      </div>
      <p id="message-bienvenue-client"></p>
    </header>

    <main id="conteneur-app" class="hidden">

      <div class="carte barre-outils">
        <? if (typeof THEME_SELECTION_ENABLED !== 'undefined' && THEME_SELECTION_ENABLED) { ?>
          <div class="theme-selector">
            <button id="btn-theme" class="btn btn-secondaire btn--client hidden" aria-haspopup="true" aria-expanded="false">Thème</button>
            <div id="menu-theme" class="hidden" role="menu">
              <button class="option-theme btn btn-secondaire btn--client" data-theme="clarte" role="menuitem">Clarté</button>
              <button class="option-theme btn btn-secondaire btn--client" data-theme="nocturne" role="menuitem">Nocturne</button>
            </div>
          </div>
        <? } ?>
      <div id="ca-client" class="carte" tabindex="0"></div>
      <div id="liste-reservations" class="carte">
        <h3>Vos prochaines courses</h3>
        <div id="contenu-reservations">
          <!-- Les réservations seront injectées ici par le script JS -->
        </div>
      </div>
      <div id="liste-factures" class="carte">
        <h3>Vos factures</h3>
        <div id="contenu-factures">
          <!-- Les factures seront injectées ici par le script JS -->
        </div>
      </div>
      <? if (typeof PRO_QA_ENABLED !== 'undefined' && PRO_QA_ENABLED) { ?>
      <div id="bloc-questions" class="carte">
        <h3>Vos questions</h3>
        <div id="liste-questions" aria-live="polite"></div>
        <form id="form-question" class="groupe-formulaire" autocomplete="off">
          <label for="question-texte">Posez votre question</label>
          <input type="text" id="question-texte" class="champ-formulaire" required aria-required="true">
          <button type="submit" class="btn btn-primaire btn--client" style="margin-top:10px;">Envoyer</button>
        </form>
      </div>
      <? } ?>
      <div class="carte">
        <p>Pour toute annulation ou pour une modification non disponible ici, veuillez nous contacter directement.</p>
        <a href="<?= ScriptApp.getService().getUrl() ?>" class="btn btn-secondaire btn--client">Faire une nouvelle réservation</a>
        <a href="mailto:<?= ADMIN_EMAIL ?>" class="btn btn-secondaire btn--client" style="margin-left: 10px;">Contacter le support</a>
      </div>
    </main>

    <div id="non-connecte" class="carte hidden">
        <h3>Accès à l'espace client</h3>
        <p>Pour consulter vos réservations, veuillez utiliser le lien qui vous a été envoyé par e-mail ou saisissez votre adresse ci-dessous.</p>
        
        <form id="formulaire-connexion-client" class="groupe-formulaire" style="margin-top: 20px;">
            <label for="email-connexion">Votre adresse e-mail :</label>
            <input type="email" id="email-connexion" class="champ-formulaire" required placeholder="exemple@domaine.com">
            <div id="erreur-connexion" class="message-erreur-connexion hidden"></div>
            <button type="submit" class="btn btn-primaire btn--client" style="margin-top: 15px; width: 100%;">Accéder à mes réservations</button>
        </form>

        <a href="<?= ScriptApp.getService().getUrl() ?>" class="btn btn-secondaire btn--client" style="margin-top: 20px;">Retour à la page de réservation</a>
    </div>
  </div>

  <div id="modale-modification" class="modale-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="modale-modification-titre">
    <div class="modale-contenu">
      <button id="btn-fermer-modale" class="btn-fermer" aria-label="Fermer la fenêtre de modification">&times;</button>
      <div class="app-logo-container" data-logo-slot>
        <span class="app-logo--fallback" data-logo-fallback="<?= nomService ?>"<?= nomService ?></span>
      </div>
      <div id="contenu-modale-wrapper">
        <!-- Le contenu de la modale sera injecté ici -->
      </div>
    </div>
  </div>

  <div id="conteneur-notifications" role="status" aria-live="polite"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.theme-selector, #btn-theme, #menu-theme').forEach(el => el && el.remove());
    });
  </script>
  <script>
    const params = new URLSearchParams(window.location.search);
    window.CLIENT_PARAMS = {
      email: params.get('email') || '',
      exp: params.get('exp') || '',
      sig: params.get('sig') || ''
    };
  </script>
  <?!= include('Render_JS'); ?>
  <?!= include('Client_JS'); ?>
  <script src="/assets/js/els-logo.js" defer></script>
</body>
</html>



